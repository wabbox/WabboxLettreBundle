(function(d,c,a,f){var e={templates:{viewing:'<a href="#" class="clearing-close">&times;</a><div class="visible-img" style="display: none"><img src="#"><p class="clearing-caption"></p><a href="#" class="clearing-main-left"></a><a href="#" class="clearing-main-right"></a></div>'},close_selectors:"a.clearing-close",initialized:false,locked:false},b={init:function(g,h){return this.find("ul[data-clearing]").each(function(){var l=d(a),j=d(this),i=i||{},m=m||{},k=j.data("fndtn.clearing.settings");if(!k){i.$parent=j.parent();j.data("fndtn.clearing.settings",d.extend({},e,i));b.assemble(j.find("li"));if(!e.initialized){b.events(j);if(Modernizr.touch){b.swipe_events()}}}})},events:function(h){var g=h.data("fndtn.clearing.settings");d(a).on("click.fndtn.clearing","ul[data-clearing] li",function(l,k,j){var k=k||d(this),j=j||k,i=k.parent().data("fndtn.clearing.settings");l.preventDefault();if(!i){k.parent().foundationClearing()}b.open(d(l.target),k,j);b.update_paddles(j)}).on("click.fndtn.clearing",".clearing-main-right",function(i){b.nav(i,"next")}).on("click.fndtn.clearing",".clearing-main-left",function(i){b.nav(i,"prev")}).on("click.fndtn.clearing",g.close_selectors,this.close).on("keydown.fndtn.clearing",this.keydown);d(c).on("resize.fndtn.clearing",this.resize);e.initialized=true},swipe_events:function(){d(a).bind("swipeleft","ul[data-clearing]",function(g){b.nav(g,"next")}).bind("swiperight","ul[data-clearing]",function(g){b.nav(g,"prev")}).bind("movestart","ul[data-clearing]",function(g){if((g.distX>g.distY&&g.distX<-g.distY)||(g.distX<g.distY&&g.distX>-g.distY)){g.preventDefault()}})},assemble:function(l){var h=l.parent(),i=h.data("fndtn.clearing.settings"),g=h.detach(),j={grid:'<div class="carousel">'+this.outerHTML(g[0])+"</div>",viewing:i.templates.viewing},k='<div class="clearing-assembled"><div>'+j.viewing+j.grid+"</div></div>";return i.$parent.append(k)},open:function(j,m,l){var h=l.closest(".clearing-assembled"),g=h.find("div:first"),i=g.find(".visible-img"),k=i.find("img").not(j);if(!b.locked()){k.attr("src",this.load(j));k.loaded(function(){h.addClass("clearing-blackout");g.addClass("clearing-container");this.caption(i.find(".clearing-caption"),j);i.show();this.fix_height(l);this.center(k);this.shift(m,l,function(){l.siblings().removeClass("visible");l.addClass("visible")})}.bind(this))}},close:function(j){j.preventDefault();var h=(function(k){if(/blackout/.test(k.selector)){return k}else{return k.closest(".clearing-blackout")}}(d(this))),g,i;if(this===j.target&&h){g=h.find("div:first"),i=g.find(".visible-img");e.prev_index=0;h.find("ul[data-clearing]").attr("style","");h.removeClass("clearing-blackout");g.removeClass("clearing-container");i.hide()}return false},keydown:function(h){var g=d(".clearing-blackout").find("ul[data-clearing]");if(h.which===39){b.go(g,"next")}if(h.which===37){b.go(g,"prev")}if(h.which===27){d("a.clearing-close").trigger("click")}},nav:function(i,h){var g=d(".clearing-blackout").find("ul[data-clearing]");i.preventDefault();this.go(g,h)},resize:function(){var g=d(".clearing-blackout .visible-img").find("img");if(g.length>0){b.center(g)}},fix_height:function(h){var g=h.siblings();g.each(function(){var i=d(this),j=i.find("img");if(i.height()>j.outerHeight()){i.addClass("fix-height")}}).closest("ul").width(g.length*100+"%")},update_paddles:function(h){var g=h.closest(".carousel").siblings(".visible-img");if(h.next().length>0){g.find(".clearing-main-right").removeClass("disabled")}else{g.find(".clearing-main-right").addClass("disabled")}if(h.prev().length>0){g.find(".clearing-main-left").removeClass("disabled")}else{g.find(".clearing-main-left").addClass("disabled")}},load:function(h){var g=h.parent().attr("href");this.preload(h);if(g){return g}return h.attr("src")},preload:function(g){this.img(g.closest("li").next());this.img(g.closest("li").prev())},img:function(g){if(g.length>0){var h=new Image(),i=g.find("a");if(i.length>0){h.src=i.attr("href")}else{h.src=g.find("img").attr("src")}}},caption:function(g,i){var h=i.data("caption");if(h){g.text(h).show()}else{g.text("").hide()}},go:function(g,j){var i=g.find(".visible"),h=i[j]();if(h.length>0){h.find("img").trigger("click",[i,h])}},shift:function(j,k,o){var l=k.parent(),i=e.prev_index,m=this.direction(l,j,k),h=parseInt(l.css("left"),10),g=k.outerWidth(),n;if(k.index()!==i&&!/skip/.test(m)){if(/left/.test(m)){this.lock();l.animate({left:h+g},300,this.unlock)}else{if(/right/.test(m)){this.lock();l.animate({left:h-g},300,this.unlock)}}}else{if(/skip/.test(m)){n=k.index()-e.up_count;this.lock();if(n>0){l.animate({left:-(n*g)},300,this.unlock)}else{l.animate({left:0},300,this.unlock)}}}o()},lock:function(){e.locked=true},unlock:function(){e.locked=false},locked:function(){return e.locked},direction:function(j,l,k){var i=j.find("li"),h=i.outerWidth()+(i.outerWidth()/4),m=Math.floor(d(".clearing-container").outerWidth()/h)-1,n=i.index(k),g;e.up_count=m;if(this.adjacent(e.prev_index,n)){if((n>m)&&n>e.prev_index){g="right"}else{if((n>m-1)&&n<=e.prev_index){g="left"}else{g=false}}}else{g="skip"}e.prev_index=n;return g},adjacent:function(j,h){for(var g=h+1;g>=h-1;g--){if(g===j){return true}}return false},center:function(g){g.css({marginLeft:-(g.outerWidth()/2),marginTop:-(g.outerHeight()/2)})},outerHTML:function(g){return g.outerHTML||new XMLSerializer().serializeToString(g)}};d.fn.foundationClearing=function(g){if(b[g]){return b[g].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof g==="object"||!g){return b.init.apply(this,arguments)}else{d.error("Method "+g+" does not exist on jQuery.foundationClearing")}}};(function(g){g.fn.loaded=function(n,l){var j=g.extend({},g.fn.loaded.defaults,l),i=this.find("img").add(this.filter("img")),k=i.length;function h(){k-=1;!k&&n()}function m(){this.one("load",h);if(g.browser.msie){var p=this.attr("src"),o=p.match(/\?/)?"&":"?";o+=j.cachePrefix+"="+(new Date()).getTime();this.attr("src",p+o)}}return i.each(function(){var o=g(this);if(!o.attr("src")){h();return}this.complete||this.readyState===4?h():m.call(o)})};g.fn.loaded.defaults={cachePrefix:"random"}}(jQuery))}(jQuery,this,this.document));